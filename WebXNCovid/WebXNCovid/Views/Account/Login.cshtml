@{
    Layout = "~/Views/Shared/_LayoutWithoutSidebar.cshtml";
}
@{
    ViewBag.Title = "ĐĂNG NHẬP";
}
<meta name="google-signin-client_id" content="659370823302-i45mk7n3pb7acojr3tdj0u0i65svnnae.apps.googleusercontent.com">
<div class="row justify-content-start">
    <div class="col-12">
        <div class="form-outer text-left d-flex align-items-center pl-5">
            <div class="form-inner">
                <div class="mb-3">
                    <strong style="font-size: 30px" class="text-primary">@ViewBag.Title</strong>
                </div>
                <div id="gg-signin-btn" style="height: 80px; padding: 15px 0px;">
                    <div class="text-left m-auto" id="my-signin2"></div>
                </div>
                <div id="loaderDiv" class="lds-ellipsis d-none"><div></div><div></div><div></div><div></div></div>
                <div class="mt-2">
                    <p class="text-primary">Bạn cần có tài khoản Gmail</p>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="https://accounts.google.com/gsi/client" async defer></script>
<script src="https://apis.google.com/js/platform.js" async defer></script>
<script src="https://apis.google.com/js/platform.js?onload=renderButton" async defer></script>
<script>
    function onSignIn(googleUser) {
        var p1 = Date.now();
        var profile = googleUser.getBasicProfile();
        var tokenSigninViewModel = {};
        tokenSigninViewModel.Email = profile.getEmail();
        tokenSigninViewModel.TokenID = googleUser.getAuthResponse().id_token;
        googleUser.disconnect()
        var p2 = Date.now();
        var a = p2 - p1;
        console.log(a);
        $.ajax({
            url: '@Url.Action("TokenSignin","Account")',
            data: JSON.stringify({ model: tokenSigninViewModel }),
            contentType: 'application/json',
            dataType: 'json',
            type: 'POST',
            beforeSend: function () {
                $("#gg-signin-btn").toggleClass("d-none");/*.toggleClass("d-none");*/
                $("#loaderDiv").toggleClass("d-none");
            },
            success: function (data) {
                if (data.success) {
                    var p4 = Date.now();
                    var a3 = p4 - p2;
                    console.log(a3)
                    $("#loaderDiv").toggleClass("d-none");
                    //call is successfully completed and we got result in data
                    window.location.replace('../../QRCodeGenerator/Index')
                }
                else {
                    window.location.replace('../../Account/LoginError')
                }
            },
            error: function (){
                window.location.replace('../../Account/Login')
            }
        });
        var p3 = Date.now();
        var a2 = p3 - p2;
        console.log(a2)
    }

    function onFailure(error) {
        console.log(error);
    }

    function renderButton() {
        gapi.signin2.render('my-signin2', {
            'scope': 'profile email',
            'width': 240,
            'height': 50,
            'longtitle': true,
            'theme': 'dark',
            'onsuccess': onSignIn,
            'onfailure': onFailure
        });
    }
</script>